---
title: ""
output:
  html_document:
    keep_md: true
    css: estilos/modest.css
    theme: spacelab
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = T, message = F, comment = NA, fig.align = "center")
```


<style>
  .espacio {
     margin-bottom: 1cm;
  }
</style>

# `#DataViz` con ggplot2 üòÅ‚ù§Ô∏è

> "The simple graph has brought more information to the data analyst‚Äôs mind 
> than any other device." --- John Tukey

## El Cuarteto de Anscombe: ¬øpor qu√© es importante la visualizaci√≥n de datos?


En 1971 un estad√≠stico llamado Frank Anscombe (fundador del departamento de Estad√≠stica de la Universidad de Yale) encontr√≥ cuatro conjuntos de datos (I, II, III y IV). Cada uno consiste de 11 observaciones y tienen las mismas propiedades estad√≠sticas.

```{r, eval=FALSE}
anscombe
```


+------+-------+-------+-------+-------+-------+------+-------+
|$x_1$ |$y_1$  |$x_2$  |$y_2$  |$x_3$  |$y_3$  |$x_4$ |$y_4$  |
+======+=======+=======+=======+=======+=======+======+=======+
| 10.0 |  8.04 |  10.0 |  9.14 |  10.0 |  7.46 |  8.0 |  6.58 |
+------+-------+-------+-------+-------+-------+------+-------+
|  8.0 |  6.95 |  8.0  |  8.14 |  8.0  |  6.77 |  8.0 |  5.76 |
+------+-------+-------+-------+-------+-------+------+-------+
| 13.0 |  7.58 | 13.0  |  8.74 | 13.0  | 12.74 |  8.0 |  7.71 |
+------+-------+-------+-------+-------+-------+------+-------+
|  9.0 |  8.81 |  9.0  |  8.77 |  9.0  |  7.11 |  8.0 |  8.84 |
+------+-------+-------+-------+-------+-------+------+-------+
| 11.0 |  8.33 | 11.0  |  9.26 | 11.0  |  7.81 |  8.0 |  8.47 |
+------+-------+-------+-------+-------+-------+------+-------+
| 14.0 |  9.96 | 14.0  |  8.10 | 14.0  |  8.84 |  8.0 |  7.04 |
+------+-------+-------+-------+-------+-------+------+-------+
|  6.0 |  7.24 |  6.0  |  6.13 |  6.0  |  6.08 |  8.0 |  5.25 |
+------+-------+-------+-------+-------+-------+------+-------+
|  4.0 |  4.26 |  4.0  |  3.10 |  4.0  |  5.39 | 19.0 | 12.50 |
+------+-------+-------+-------+-------+-------+------+-------+
| 12.0 | 10.84 | 12.0  |  9.13 | 12.0  |  8.15 |  8.0 |  5.56 |
+------+-------+-------+-------+-------+-------+------+-------+
|  7.0 |  4.82 |  7.0  |  7.26 |  7.0  |  6.42 |  8.0 |  7.91 |
+------+-------+-------+-------+-------+-------+------+-------+
|  5.0 |  5.68 |  5.0  |  4.74 |  5.0  |  5.73 |  8.0 |  6.89 |
+------+-------+-------+-------+-------+-------+------+-------+

Por ejemplo, todos los conjuntos de datos I, II, III, y IV, tienen exactamente misma media de $x$, $\bar{x}_i = \bar{x}_j$, y misma media de $y$, $\bar{y}_i = \bar{y}_j$ para toda $i,j=1,2,3,4$. Adem√°s, se puede ver que todos tienen misma varianza muestral de $x$ y de $y$. En cada conjunto de datos la correlaci√≥n entre $x$ y $y$ es la misma, y por consiguiente, los coeficientes de la regresi√≥n lineal $\beta_0$ y $\beta_1$ tambi√©n son iguales. 

+-----------------------------+-------------------+
|Propiedad                    |Valor              |
+=============================+===================+
|Media de $x$                 |9                  |
+-----------------------------+-------------------+
|Varianza muestral de $x$     |11                 |
+-----------------------------+-------------------+
|Media de $y$                 |7.50               |
+-----------------------------+-------------------+
|Varianza muestral de $y$     |4.12               |
+-----------------------------+-------------------+
|Correlaci√≥n entre $x$ y $y$  |0.816              |
+-----------------------------+-------------------+
|L√≠nea de regresi√≥n lineal    |$y = 3.00 + 0.500x$|
+-----------------------------+-------------------+

¬øEn qu√© son diferentes estos conjuntos de datos? ¬øEs posible con la informaci√≥n anterior concluir que los cuatro conjuntos de datos deben ser similares? ¬øQue tengan estad√≠sticas similares asegura que provienen de un mismo modelo?


Cuando analizamos los datos de manera gr√°fica en un histograma encontramos r√°pidamente que los conjuntos de datos son muy distintos.

<div style="text-align: center;">**‚ÄúUna imagen dice m√°s que mil palabras.‚Äù**</div>
<center><img src="figuras/Anscombe.png" width="600px" /></center>
<p class="espacio">
</p>

En la gr√°fica del primer conjunto de datos, se ven datos como los que se tendr√≠an en una relaci√≥n lineal simple con un modelo que cumple los supuestos de normalidad. La segunda gr√°fica (la de arriba a la derecha) muestra unos datos que tienen una asociaci√≥n pero definitivamente no es lineal y el coeficiente de correlaci√≥n no es relevante en este caso. En la tercera gr√°fica (abajo a la izquierda) est√°n puntos alineados perfectamente en una l√≠nea recta, excepto por uno de ellos. En la √∫ltima gr√°fica podemos ver un ejemplo en el cual basta tener una observaci√≥n at√≠pica para que se produzca un coeficiente de correlaci√≥n alto a√∫n cuando en realidad no existe una asociaci√≥n lineal entre las dos variables.  

Edward Tufte us√≥ el cuarteto en la primera p√°gina del primer cap√≠tulo de su libro The Visual Display of Quantitative Information, para enfatizar la importancia de mirar los datos antes de analizarlos. [1]

El cuarteto de Anscombe es un ejemplo extremo y que fue construido deliberadamente para demostrar esta idea. Sin embargo, los beneficios de visualizar datos pueden mostrarse en casos reales. Abajo se muestra una gr√°fica de Jackman (1980) que aparece en un art√≠culo corto como comentario a Hewitt (1977). En su paper original, Hewitt afirma que existen una asociaci√≥n significativa entre el porcentaje de votantes y la desigualdad por ingreso utilizando un an√°lisis de regresi√≥n l√≠neal con datos de 18 pa√≠ses. Una prueba de validaci√≥n cruzada sencilla hubiera detectado el problema, pero la ayuda visual d√≠ficilmente se puede refutar.

<center><img src="figuras/ch-02-jackman-outlier.png" width="400px" /></center>
<p class="espacio">
</p>

Un ejemplo menos extremo es el de Jan Vanhove [9] que descubri√≥ una manera de generar un arreglo num√©rico (variable $y$) que tenga una correlaci√≥n fija $\rho$ dado otro arreglo n√∫merico (variable $x$). Con esto pudo construir una gr√°fica como la que se muestra a continuaci√≥n. 


![](figuras/02-correlations-1.png)

En la gr√°fica se muestran puntos de datos generados aleatoriamente. En cada panel los puntos tienen una correlaci√≥n de $0.5$. Se puede ver la regla con la cual fueron producidos los puntos en cada panel. Por ejemplo, en el primer panel la variable $x$ es una muestra de una distribuci√≥n normal y la variable $y$ fue construida de tal forma que la correlaci√≥n entre $x$ y $y$ es $0.5$ y los residuales de la regresi√≥n tambi√©n cumplen el supuesto de normalidad. Sin embargo, no todos los casos son iguales. Y en el √∫ltimo caso, el n√∫mero 16 en el que la variable $x$ es categ√≥rica, claramente no hay ning√∫n tipo de asociaci√≥n entre las variables que se muestran en la gr√°fica.

Podemos concluir, por lo tanto, que una visualizaci√≥n es importante. Una gr√°fica puede resultar √∫til para ver lo datos. Los datos reales generalmente vienen sucios, y consecuentemente, presentarlos gr√°ficamente conllevan una dificultad inherente. Ha habido un enorme debate sobre qu√© tipo de gr√°fica es m√°s efectiva, cu√°ndo una visualizaci√≥n deja de ser √∫til y pasa a ser superflua, e incluso cu√°ndo en ocasiones puede ser enga√±osa tanto para los investigadores como para cualquier tipo de audiencia por igual. 


![](figuras/image00.png)

A√∫n a pesar del cuarteto de Anscombe, y en especial para grandes vol√∫menes de datos, tanto los res√∫menes num√©ricos como las gr√°ficas nos sirven como una herramienta para hacer simplificaciones  **deliberadamente**, para poder ver m√°s all√° de una nube de puntos. Pero no siempre vamos a encontrar todas las respuestas √∫nicamente _viendo_. [3]

## ¬øPor qu√© es importante que la visualizaci√≥n sea correcta?


<p class="espacio">
</p>
<p class="espacio">
</p>

<div style="text-align: center;">**‚ÄúThere are three kinds of lies: lies, damned lies, and statistics.‚Äù**</div>

<div style="text-align: center;">
*Mark Twain*

</div>

<center><img src="figuras/Mark_Twain.jpg" width="300px" /></center>
<p class="espacio">
</p>

En su libro The Visual Display of Quantitative Information (1983), Edward R. Tufte logra extraer una serie de principios generales (o reglas de dedo) a partir de una serie de ejemplos de buenas y malas visualizaciones. El mensaje de Tufte aunque es frustrante es consistente:

> Una gr√°fica excelente gr√°fica presenta datos interesantes de forma bien dise√±ada: es una cuesti√≥n de fondo, de dise√±o, y estad√≠stica... [Se] compone de ideas complejas comunicadas con claridad, precisi√≥n y eficiencia. ... [Es] lo que da al espectador la mayor cantidad de ideas, en el menor tiempo, con la menor cantidad de tinta, y en el espacio m√°s peque√±o. ... Es casi siempre multivariado. ... Una excelente gr√°fica debe decir la verdad acerca de los datos. (Tufte, 1983)

Tufte ilustra el punto con la famosa visualizaci√≥n de Charles Joseph Minard de la marcha de Napole√≥n sobre Mosc√∫, que se muestra aqu√≠ en la Figura 2.5. Se√±ala que esta imagen "bien podr√≠a ser el mejor gr√°fico estad√≠stico jam√°s dibujado", y sostiene que "cuenta una historia rica y coherente con sus datos multivariados, mucho m√°s esclarecedora que un solo n√∫mero que rebota en el tiempo". Se representan seis variables: el tama√±o del ej√©rcito, su ubicaci√≥n en una superficie bidimensional, la direcci√≥n del movimiento del ej√©rcito y la temperatura en varias fechas durante la retirada de Mosc√∫ ".

Tufte utiliza como ejemplo una visualizaci√≥n famosa de 1869 de Charles Joseph Minard, un ingeniero franc√©s que trabajaba en Bordeaux. 

![](figuras/Minard.png)

Hoy en d√≠a Minard es reconocido como uno de los principales contribuyentes a la teor√≠a de an√°lisis de datos y creaci√≥n de **infograf√≠as** con un fundamento estad√≠stico.


En primer instancia, la gr√°fica es impresionante por su representaci√≥n en dos dimensiones de seis tipos de datos:

- el n√∫mero de tropas de Napole√≥n

- la distancia

- la temperatura

- la latitud y la longitud

- la direcci√≥n en que viajaban las tropas

- y la localizaci√≥n relativa a fechas espec√≠ficas.


El portafolio original de Minard *Tableaux Graphiques et Cartes Figuaratives de M. Minard* se encuentra actualmente en la Biblioth√®que de l'√âcole Nationale des Ponts et Chauss√©es, Par√≠s.

Podemos pensar en lo lejano que est√° la gr√°fica de Minard de la mayor√≠a de las gr√°ficas estad√≠sticas que se hacen hoy en d√≠a. Actualmente, las gr√°ficas tienden a ser aplicaciones o generalizaciones de las gr√°ficas de dispersi√≥n y las gr√°ficas de barras con el objetivo de graficar los datos crudos o de ver el resultado de un modelo. Mientras que la visualizaci√≥n de Minard busca aumentar el volumen de datos visibles, el n√∫mero de variables que se muestran dentro de un panel, o el n√∫mero de p√°neles que se muestran en la gr√°fica, nuestras visualizaciones de hoy en d√≠a buscan formas de ver los resultados, de estimaciones puntuales, intervalos de confianza o los "pron√≥sticos" de manera f√°cil y comprensible. 
Finalmente, Tufte concluye que un __"tour de force"__ como el de Minard "puede ser descrito y admirado, pero no existe una seire de principios compositivos sobre c√≥mo crear esta gr√°fica √∫nica y maravillosa gr√°fica". Lo m√°s que se puede hacer para obtener una gu√≠a "rutinaria, de dise√±os de uso diario" es sugerir algunas pautas como "tener un formato y dise√±o adecuado" para nuestras gr√°ficas del d√≠a a d√≠a, "usar palabras, n√∫meros y dibujos simult√°neamente", "mostrar una complejidad de detalle accesible", y "evitar la decoraci√≥n sin contenido, es decir, el __chartjunk__" (Tufte 1983, 177).

A continuaci√≥n vamos a mostrar una serie de principios que ilustran c√≥mo mejorar la utilidad (y la veracidad üòÖ) de una gr√°fica.

### Eje $y$ truncado

A mediados de diciembre del 2015, la Casa Blanca tweete√≥: "Buenas noticias: la tasa de graduados en las escuelas de secundaria de Estados Unidos ha aumentado a un m√°ximo hist√≥rico". El tweet inclu√≠a una gr√°fica.

![](figuras/truncated_y/obama.png)

Esto tiene varios problemas. En primer lugar, nunca es una buena idea ilustrar elementos de una gr√°fica. ¬øQu√© significa que cinco libros equivalen al 75%, o que 16 libros equivalen al 82%? Pero, en √∫ltima instancia, √©sta es una gr√°fica de barras, y las gr√°ficas de barras siempre deben comenzar el eje vertical en cero. Aqu√≠ est√°n los mismos datos en una escala apropiada:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
obama <- tibble(Year = 2008:2014, `Graduation rate` = c(0.75,0.75,0.78,0.79,0.80,0.81,0.82))
ggplot(obama, aes(x=Year, y = `Graduation rate`)) +
  geom_bar(stat="identity") +
  scale_x_continuous(breaks = 2008:2014)
```

¬°No se obtienen resultados tan dram√°ticos con esta nueva gr√°fica! üôÉ Pero los problemas no terminan con esta tabla. Supuestamente los datos de estas tasas de graduaci√≥n provienen del Departamento de Educaci√≥n de Estados Unidos (NCES). Sin embargo, estos datos no se encuentran en ninguna fuente de datos p√∫blica. Entonces, ¬øla Casa Blanca sac√≥ estas tasas de graduaci√≥n de m√∫ltiples conjuntos de datos? Fuentes distintas pueden medir las tasas de graduaci√≥n de diferentes maneras, lo que ser√≠a problem√°tico. üí© Probablemente la administraci√≥n de Obama ten√≠a acceso a fuentes de datos que no est√°n disponibles p√∫blicamente. 

Aqu√≠ hay otros ejemplos en los que se ha cometido este mismo error en los medios:

<center><img src="figuras/truncated_y/misleading1_baseball.jpg" width="600px" /></center>
<p class="espacio">
</p>

<center><img src="figuras/truncated_y/misleading1_fox.jpg" width="600px" /></center>
<p class="espacio">
</p>

### Gr√°fica acumulada

Muchas personas optan por crear gr√°ficas acumuladas de cosas como cantidad de usuarios, ingresos, descargas u otras m√©tricas importantes. Por ejemplo, en lugar de mostrar una gr√°fica del n√∫mero de iPhones vendidos trimestralmente, Tim Cook elegi√≥ mostrar un total acumulado del n√∫mero de iPhones vendidos hasta la fecha.

![](figuras/cumulative_y/iphone-sales.jpg)

<p class="espacio">
</p>

En el mejor de los casos, la gr√°fica es enga√±osa; en el peor, es falsa. Esta gr√°fica no tiene escala. El n√∫mero de iPhones vendidos podr√≠a estar en miles de millones o en cientos. M√°s a√∫n, mostrar las ventas acumulativas t√°citamente exagera la cantidad de usuarios de iPhone, ya que podemos suponer que una parte considerable de las compras del iPhone son para reemplazar otros iPhones viejos o rotos. 

<p class="espacio">
</p>
Usando datos de los informes trimestrales  de Apple presentados ante la Comisi√≥n de Bolsa y Valores, Yanofsky (2013) hizo la siguiente gr√°fica:

![](figuras/cumulative_y/lb_7986_adjusted_bw.png)
<p class="espacio">
</p>

Si analizamos la gr√°fica acumulada, es posible ver que la pendiente est√° aumentando o disminuyendo a medida que pasa el tiempo, lo que indica una disminuci√≥n en la venta del iPhone en los √∫ltimos 3 trimestres. Sin embargo, no es inmediatamente obvio, y la gr√°fica es incre√≠blemente enga√±osa.

### Ignorar convenciones

Cuando se ignoran las pr√°cticas est√°ndar se puede llegar a construir visualizaciones de datos enga√±osas. Estamos acostumbrados, por ejemplo, a que las gr√°ficas de pie representan partes de un todo, o que los tiempos avanzan de izquierda a derecha. Entonces, cuando esas reglas son violadas, nos es dif√≠cil ver lo que est√° sucediendo realmente. 

Aqu√≠ hay un ejemplo de una gr√°fica de pie que present√≥ Fox durante las primarias presidenciales del 2012:
<center><img src="figuras/areas/misleading3_pie.png" width="400px" /></center>
<p class="espacio">
</p>


Las tres partes del pie no suman 100%. La encuesta presumiblemente permiti√≥ respuestas m√∫ltiples, en cuyo caso una gr√°fica de barras hubiera sido m√°s apropiada. En cambio, esta gr√°fica de pie nos da  la impresi√≥n de que cada uno de los tres candidatos tuvo aproximadamente un tercio del apoyo, lo cual no es cierto.

Otro ejemplo es esta visualizaci√≥n publicada por Business Insider, que parece mostrar lo contrario de lo que realmente est√° sucediendo:

<center><img src="figuras/areas/misleading3_deaths.jpg" width="400px" /></center>
<p class="espacio">
</p>


A primera vista, parece que las muertes por arma de fuego est√°n disminuyendo en Florida. Pero analizando la gr√°fica m√°s a fondo podemos ver que el eje vertical (el eje $y$) est√° al rev√©s, con cero en la parte superior y el valor m√°ximo en la parte inferior. A medida que aumentan las muertes por armas de fuego, la l√≠nea se inclina hacia abajo, violando una convenci√≥n bien establecida de que los valores y aumentan a medida que avanzamos hacia arriba de la gr√°fica.

De todo esto podemos llegar a una conclusi√≥n sencilla: debemos tener cuidado al dise√±ar visualizaciones y al interpretar las gr√°ficas creadas por otros.

### Datos _cuchareados_

Despu√©s de un tiroteo en San Bernardino, California, hubo mucha discusi√≥n sobre qu√© casos considerar como tiroteos masivos. Existen muchas fuentes de datos pero el problema es que todas consideran distintos criterios. Algunos solamente cuentan incidentes en los cuales cuatro o m√°s personas fueron asesinadas.

El 2 de diciembre de 2015, un sitio web llamado Truthstream Media public√≥ una historia titulada "¬øPor qu√© ha habido m√°s tiroteos masivos bajo el presidente Obama que bajo los cuatro presidentes anteriores juntos?" Inclu√≠a la siguiente gr√°fica, que seg√∫n se bas√≥ en tres fuentes de datos. Una era la base de datos Mother Jones de tiroteos masivos, que usa los criterios de cuatro asesinados o m√°s. Las otras dos eran de Wikipedia.

![](figuras/shootings.jpg)

<p class="espacio">
</p>

Despu√©s de una revisar las fuentes de datos utilizadas, encontraron que el sitio web hab√≠a cuchareado los datos considerando casos de asesinatos dom√©sticos bajo la administraci√≥n de Obama, pero excluyendo casos similares que ocurrieron durante el periodo de sus predecesores. Utilizando √∫nicamente los datos de Mother Jones podemos construir la siguiente gr√°fica:

```{r, message=FALSE, warning=FALSE, echo=FALSE}
shootings <- read_csv(file = 'datos/Mother_Jones_Mass_Shootings.csv')
presidents <- tibble(Year = c(1982:1989, 1990:1993, 1994:2001, 2002:2009, 2010:2017),
                     President = c(rep("Ronald Reagan", 8),
                                   rep("George H. W. Bush", 4),
                                   rep("Bill Clinton", 8),
                                   rep("George W. Bush", 8),
                                   rep("Barack Obama", 8)))
presidents$President <- ordered(presidents$President, levels=unique(presidents$President))
sh_pr <- shootings %>% 
  left_join(presidents, by = "Year") %>%
  filter(Fatalities >= 4 & Type == "Mass")
ggplot(sh_pr, aes(x=President, y=..count..)) +
  geom_bar() +
  coord_flip()
```

Utilizando √∫nicamente una fuente de datos, las conclusiones no son tan exorbitantes.

### Eje $y$ sesgado

En una audiencia celebrada el 29 de septiembre, los republicanos en el Congreso de los Estados Unidos interrogaron a la presidenta de Planned Parenthood, Cecile Richards, acus√°ndola de hacer un uso indebido de los $500 millones en fondos federales anuales de la organizaci√≥n. Para aclarar el punto, el representante Jason Chaffetz de Utah mostr√≥ esta gr√°fica:

![](figuras/planned_parenthood.jpg)

<p class="espacio">
</p>

Y as√≠ es como el congresista explic√≥ la tabla: "En rosa, se ve la reducci√≥n en los ex√°menes de c√°ncer y servicios de prevenci√≥n, y en rojo se muestra el aumento en los abortos. Eso es lo que est√° sucediendo en su organizaci√≥n".

A primera vista, puede parecer que el n√∫mero de abortos realizados por Planned Parenthood se ha disparado, mientras que el n√∫mero de ex√°menes de detecci√≥n de c√°ncer se ha desplomado. Uno tambi√©n podr√≠a quedar con la impresi√≥n de que la organizaci√≥n ha estado realizando m√°s abortos que procedimientos preventivos desde 2010. Pero ese no es el caso. El problema principal con esta gr√°fica es que no tiene un eje $y$ discernible, por lo que la ubicaci√≥n de las l√≠neas es arbitraria. Creer esta gr√°fica tal como se presenta es equivalente a creer que 327,000 es un n√∫mero mayor que 935,573.

Con la gu√≠a de los expertos, en PolitiFact [10] compilaron la cantidad de abortos y servicios de detecci√≥n/prevenci√≥n del c√°ncer de los informes anuales de Planned Parenthood de 2006 a 2013 (no pudieron encontrar el informe correspondiente a 2008). As√≠ es como se deber√≠a ver la gr√°fica:

![](figuras/politifact_planned_parenthood.png)

<p class="espacio">
</p>

La cantidad de pruebas de detecci√≥n de c√°ncer y servicios preventivos disminuy√≥, eso era cierto. Sin embargo, la tasa de cambio del n√∫mero de abortos realizados se mantuvo constante.

Como √∫ltimo ejemplo, tenemos esta gr√°fica que apareci√≥ en un tweet:

![](figuras/nro_graph.png)

<p class="espacio">
</p>

√âsta es la gr√°fica en la cual debemos pensar cuando alguien asegura que el eje $y$ siempre debe comenzar en cero. Un cambio de incluso un grado en la temperatura global promedio es significativo, pero el hecho de que el eje comience en cero lo hace ver min√∫sculo. 

Bussiness week hizo esta comparaci√≥n con la gr√°fica anterior:

![](figuras/bizweekgraphics.png)

<p class="espacio">
</p>

Podemos repetir la gr√°fica utilizando datos de la NASA en una escala m√°s apropiada:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# https://data.giss.nasa.gov/gistemp/tabledata_v3/GLB.Ts+dSST.txt
temp <- read_csv("datos/nasa_temperatures.csv")
ggplot(temp, aes(x=Year, y=`J-D`)) +
  geom_line() +
  scale_y_continuous(name="Change in average temperature in degrees Celsius")
```


## Principios para hacer que una visualizaci√≥n sea efectiva

Consideremos la siguiente gr√°fica sobre esperanza de vida en el 2007:

<center><img src="figuras/ch-02-chartjunk-life-expectancy.png" width="400px" /></center>
<p class="espacio">
</p>


Podemos analizar otras dos formas de visualizar estos datos de la esperanza de vida por continente. Una diferencia entre ambas gr√°ficas es la escala: la gr√°fica de barras comienza en cero y la longitud de cada barra representa el valor de la variable "esperanza de vida promedio en 2007" para cada continente. Por otro lado, el panel de la derecha es un diagrama de puntos de Cleveland. Cada observaci√≥n est√° representada por un punto, y la escala est√° restringida al rango de los datos como se muesgtra.

```{r, echo=FALSE, fig.width=12, message=FALSE, warning=FALSE, fig.align='center'}
library(png)
library(grid)
library(gridExtra)
img1 <-  rasterGrob(as.raster(readPNG("figuras/02-bar-simple-1.png")), interpolate = FALSE)
img2 <-  rasterGrob(as.raster(readPNG("figuras/02-bar-simple-2.png")), interpolate = FALSE)
grid.arrange(img1, img2, ncol = 2)
```

¬øCu√°l es el preferido? Es dif√≠cil dar una respuesta inequ√≠voca. Todo depende de qu√© tan seguido se use un tipo de gr√°fica m√°s que la otra para enga√±ar a los dem√°s. Sin embargo, en este caso tal vez utilizar una gr√°fica de barras para representar una media (en espec√≠fico la esperanza de vida) no sea la mejor idea.


### Tipos de variables

- cuantitativas o de intervalo
    
    &nbsp;&nbsp;&nbsp;&nbsp;altura, peso, edad, ingreso

- ordinal

    &nbsp;&nbsp;&nbsp;&nbsp;nivel educativo

- nominal

    &nbsp;&nbsp;&nbsp;&nbsp;ciudad, c√≥digo postal, raza, g√©nero

### Geometr√≠as que se pueden utilizar

<div style="text-align: center;">**¬øQu√© geometr√≠as puedo usar?**</div>
<center><img src="figuras/visual-variables-only.png" width="200px" /></center>
<p class="espacio">
</p>

### The _Grammar of Graphics_ de Leland Wilkinson

Una ventaje de ggplot es que implementa una gram√°tica de gr√°ficas de forma organizada y con sentido orientada a esta forma de asociar variables con geometr√≠as (Wilkinson 2005). En lugar de tener una lista enorme y conceptualmente plana de opciones para hacer gr√°ficas, ggplot parte en varios pasos el procedimiento para realizar una gr√°fica:

1. primero, se debe proporcionar informaci√≥n a la funci√≥n sobre qu√© datos y qu√© variables se van a utilizar.

2. segundo, se debe vincular las variables que se van a utilizar en la gr√°fica con las caracter√≠sticas espec√≠ficas que se requiere tener en la gr√°fica.

3. tercero, se debe elegir una funci√≥n `geom_` para indicar qu√© tipo de gr√°fica se dibujar√°, un diagrama de dispersi√≥n, una gr√°fica de barras o un diagrama de caja.


En general, seg√∫n Leland Wilkinson, hay dos principios generales que se deben seguir:

- La geometr√≠a utilizada debe coincidir con los datos que se est√°n visualizando.

- La geometr√≠a utilizada debe ser f√°cil de interpretar.


### Codificaci√≥n para cada tipo de variable

Cleveland y otros investigadores han estudiado qu√© geometr√≠as son m√°s adecuadas para cada tipo de variable y qu√© geometr√≠as facilitan una percepci√≥n correcta de los datos para cada tipo de variable.

<div style="text-align: center;">**¬øQu√© geometr√≠as son m√°s adecuadas para cada tipo de variable?**</div>
<center><img src="figuras/visual-variables.png" width="600px" /></center>
<p class="espacio">
</p>

### Percepci√≥n de escala


Entre la percepci√≥n visual y la interpretaci√≥n de una gr√°fica est√°n impl√≠citas tareas visuales espec√≠ficas que las personas debemos realizar para ver correctamente la gr√°fica. En la d√©cada de los ochenta, William S. Cleveland y Robert McGill realizaron algunos experimentos identificando y clasificando estas tareas para diferentes tipos de gr√°ficos [23, 24]. Generalmente se le pregunta a la persona que compare _dos_ valores dentro de una gr√°fica, por ejemplo, dos barras en una gr√°fica de barras, o dos rebanadas de una gr√°fica de pie.

![](figuras/ch-02-cleveland-task-types.png)

<p class="espacio">
</p>

Para cada tipo de gr√°fica, se pidi√≥ a los sujetos que identificaran el segmento o la parte m√°s peque√±a de las dos marcadas en la gr√°fica, y luego que "hicieran un juicio visual r√°pido", estimando qu√© porcentaje era el m√°s peque√±o del m√°s grande. Los tipos 1-3 usan una codificaci√≥n de posici√≥n a lo largo de una escala com√∫n, mientras que los tipos 4 y 5 usan una codificaci√≥n de longitud. La gr√°fica de pie codifica los valores como √°ngulos, la gr√°fica de burbujas y las rectangulares las codifican como √°reas circulares o √°reas rectangulares. 

Los resultados de Cleveland y McGill fueron replicados por Heer y Bostock en 2010 y los resultados se muestran a continuaci√≥n:

<center><img src="figuras/ch-02-heer-bostock-results.png" width="600px" /></center>
<p class="espacio">
</p>


El patr√≥n general es claro, la percepci√≥n correcta de una gr√°fica empeora conforma nos alejamos de hacer comparaciones en una escala com√∫n a hacer comparaciones basadas en longitudes, hasta √°ngulos y finalmente √°reas. Las comparaciones de √°reas tienen resultados particularmente malos, incluso peores que los de la difamada (merecidamente) gr√°fica de pie.


<p class="espacio">
</p>

<div style="text-align: center;">**Dejemos los pie's para el postre**</div>
<center><img src="figuras/pie_dessert.png" width="200px" /></center>
<p class="espacio">
</p>

Para ilustrar la dificultad al interpretar las gr√°ficas de pie, consideremos la siguiente gr√°fica de pie con seis rebanadas. Observemos que en este caso es f√°cil determinar que la porci√≥n de la Compa√±√≠a C (parte verde) es del 25%, exactamente una cuarta parte del pastel.

<p class="espacio">
</p>

<center><img src="figuras/pastel_1.png" width="450px" /></center>
<p class="espacio">
</p>


Notemos ahora que si rotamos el pie, hasta la rebanada verde del 25% ya no es tan f√°cil de reconocer como tal.

<p class="espacio">
</p>

<center><img src="figuras/pastel_2.png" width="450px" /></center>
<p class="espacio">
</p>

Podemos argumentar que el problema se resuelve poniendo etiquetas en cada rebanada para indicar el porcentaje que representa.

<p class="espacio">
</p>

<center><img src="figuras/pastel_3.png" width="500px" /></center>
<p class="espacio">
</p>

Pero para el caso ser√≠a mejor agregar a las etiquetas el nombre correspondiente a cada rebanada para evitar tener que mover los ojos entre el pie y la leyenda de la gr√°fica.

<p class="espacio">
</p>

<center><img src="figuras/pastel_4.png" width="550px" /></center>
<p class="espacio">
</p>

Esto resulta en un absurdo, ya que la gr√°fica no est√° aportando ninguna ventaja con respecto a ver los porcentajes en una tabla o en una gr√°fica de barras.

<p class="espacio">
</p>

<center><img src="figuras/pastel_5.png" width="600px" /></center>
<p class="espacio">
</p>

Si decimos que el c√≠rculo peque√±o tiene √°rea de _una_ unidad y nos preguntamos cu√°l es el √°rea del c√≠rculo grande, ¬°vamos a sudar la gota gorda! Generalmente el valor que las personas le asignan al √°rea del c√≠rculo grande est√° en el rango de 4 a 60, cuando en realidad el √°rea es de 16.


<center><img src="figuras/circleAreas.png" width="600px" /></center>
<p class="espacio">
</p>


En la siguiente imagen podemos analizar la relaci√≥n entre la correcta percepci√≥n de una gr√°fica y las distintas formas de codificar las cantidades que se est√°n representando.

<center><img src="figuras/apparentmagnitudegraph.png" width="600px" /></center>
<p class="espacio">
</p>

Un aspecto importante que debemos hacer notar es que nuestros ojos mienten. 

![](figuras/ebbinghaus.gif)

<p class="espacio">
</p>

Y si queremos utilizar el √°rea para codificar nuestros datos, entonces debemos asegurarnos de hacerlo correctamente y no utilizar el ancho o la altura para representar √°reas de objetos que ultimadamente no tendr√°n ning√∫n sentido.

<div style="text-align: center;">**¬°Hasta la Casa Blanca lo tuvo mal!**</div>
<center><img src="figuras/areas/obamaCircles.jpg" width="600px" /></center>
<p class="espacio">
</p>


<p class="espacio">
</p>

## La trifecta de una gr√°fica

La trifecta de una gr√°fica (definida por Fung en 2015) es un marco general para la cr√≠tica de visualizaci√≥n de datos. El objetivo es tratar de dar un conjunto de "reglas generales" para una cr√≠tica de visualizaci√≥n de datos.


<div style="text-align: center;">**La trifecta de una gr√°fica**</div>
<center><img src="figuras/trifecta.png" width="200px" /></center>
<p class="espacio">
</p>

Una gr√°fica siempre debe tener una pregunta (Q), que aparece en la parte superior de la trifecta porque cualquier visualizaci√≥n debe tener un _objetivo_. Debe estar bien planteada y ser interesante. Un buen planteamiento se dirige a la b√∫squeda de los datos apropiados para hacer la gr√°fica. Una pregunta interesante asegura una audiencia comprometida.

En segundo lugar est√°n lo datos (D). Los datos deben ser relevantes para responder la pregunta que se est√° abordando. La relevancia a menudo puede aumentar si se reduce el ruido en los datos, si los datos tienen menos errores o transformaciones.

Por √∫ltimo, los elementos visuales (V) deben presentar los datos de una manera clara y concisa, abordando la pregunta directamente.

### ggplot

Vamos a ver c√≥mo visualizar los datos usando ggplot2. R tiene varios sistemas para hacer gr√°ficas, pero ggplot2 es uno de los m√°s elegantes y vers√°tiles. ggplot2 implementa la __gram√°tica de gr√°ficas__,  un sistema consistente para describir y construir gr√°ficas. Con ggplot2, pueden hacerse cosas m√°s r√°pido, aprendiendo un √∫nico sistema consistente, y aplic√°ndolo de muchas formas.

Para mayor informaci√≥n sobre los fundamentos te√≥ricos de ggplot2 se recomienda leer el art√≠culo titulado "The Layered Grammar of Graphics", visitando la siguiente liga: <http://vita.had.co.nz/papers/layered-grammar.pdf>.

Lo m√°s importante para entender ggplot es comprender la estructura y la l√≥gica para hacer una gr√°fica. El c√≥digo debe decir cu√°les son las conexiones entre las variables en los datos y los elementos de la gr√°fica tal como los vamos a ver en la pantalla, los puntos, los colores y las formas. En ggplot, estas conexiones l√≥gicas entre los datos y los elementos de la gr√°fica se denominan *asignaciones est√©ticas* o simplemente *est√©ticas*. Se comienza una gr√°fica indicando a ggplot cu√°les son los datos, qu√© variables en los datos se van a usar y luego c√≥mo las variables en estos datos se mapean l√≥gicamente en la est√©tica de la gr√°fica. Luego, toma el resultado y se indica qu√© tipo de gr√°fica se desea, por ejemplo, un diagrama de dispersi√≥n, una gr√°fica de barras, o una gr√°fica de l√≠nea. En ggplot este tipo general de gr√°ficas se llama `geom`. Cada *geom* tiene una funci√≥n que lo crea. Por ejemplo, `geom_point()` hace diagramas de dispersi√≥n, `geom_bar()` hace gr√°ficas de barras, `geom_line()` hace gr√°ficas de l√≠nea, y as√≠ sucesivamente. Para combinar estas dos piezas, el objeto `ggplot()` y el `geom` se suman literalmente en una expresi√≥n, utilizando el s√≠mbolo "`+`".
 
<div style="text-align: center;">**¬øQu√© geometr√≠as son m√°s adecuadas para cada tipo de variable?**</div>
<center><img src="figuras/visual-variables.png" width="600px" /></center>
<p class="espacio">
</p>


Usaremos los datos de `gapminder` para hacer nuestras primeras gr√°ficas. Vamos a asegurarnos de que la biblioteca que contiene los datos est√© cargada:


```{r, message=FALSE, warning=FALSE}
library(gapminder)
```

Esto hace que una tabla de datos est√© disponible para su uso. Para ver un pedazo de la tabla utilizamos la funci√≥n `glimpse()`:

```{r}
glimpse(gapminder)
```


Supongamos que queremos graficar la esperanza de vida vs el PIB per c√°pita para todos los a√±os y pa√≠ses en los datos. Haremos esto creando un objeto que contenga parte de la informaci√≥n necesario y a partir de ah√≠ vamos a construir nuestra gr√°fica. Primero debemos indicarle a la funci√≥n `ggplot()` qu√© datos estamos utilizando:

```{r}
p <- ggplot(data = gapminder)
```

En este punto, ggplot sabe cu√°les son nuestros datos, pero no cu√°l es el mapeo, es decir, qu√© variables de los datos deben correlacionarse con qu√© elementos visuales de la trama. Tampoco sabe qu√© tipo de trama queremos. En ggplot, las asignaciones se especifican utilizando la funci√≥n aes (). Me gusta esta:

Hasta este punto ggplot conoce qu√© datos se van a utilizar para hacer la gr√°fico, pero no el *mapeo* o *asociaci√≥n* de qu√© variables se van a relacionar con los elementos visuales de la gr√°fica. Tampoco se sabe qu√© tipo de gr√°fica se va a hacer. En ggplot, las asignaciones se especifican utilizando la funci√≥n `aes()`:

```{r}
p <- ggplot(data = gapminder,
            mapping = aes(x = gdpPercap,
                          y = lifeExp))
```

El argumento `mapping = aes(...)` _vincula variables a cosas que se van a ver en la gr√°fica_. Los valores de $x$ y $y$ son los m√°s obvios. Otras asignaciones est√©ticas pueden incluir, por ejemplo, el color, la forma, el tama√±o y el tipo de l√≠nea (si una l√≠nea es s√≥lida o discontinua, o alg√∫n otro patr√≥n). Un mapeo no dice directamente qu√© formas o colores van a aparecer en la gr√°fica. M√°s bien, dicen qu√© _variables_ en los datos ser√°n _representadas_ por los elementos visuales como color, forma o un punto.

¬øQu√© sucede si simplemente escribimos `p` en la consola y ejecutamos?

```{r, fig.width = 5, fig.height = 4}
p
```

El objeto p ha sido creado por la funci√≥n ggplot (), y ya tiene informaci√≥n sobre las asignaciones que queremos, junto con mucha otra informaci√≥n a√±adida por defecto. (Si quiere ver cu√°nta informaci√≥n hay en el objeto p, intente solicitar str (p)). Sin embargo, no le hemos dado ninguna instrucci√≥n acerca de qu√© tipo de diagrama dibujar. Necesitamos agregar una capa a la trama. Esto significa elegir una funci√≥n geom_. Usaremos geom_point (). Sabe c√≥mo tomar valores xey y trazarlos en un diagrama de dispersi√≥n.

Se ha creado el objeto `p` utilizando la funci√≥n `ggplot()` y este objeto ya tiene informaci√≥n de las asignacionesque queremos. Sin embargo, no se le ha dado ninguna instrucci√≥n sobre qu√© tipo de gr√°fica se quiere dibujar. Necesitamos agregar una capa a la gr√°fica. Esto se hace mediante el s√≠mbolo `+`. Esto significa elegir una funci√≥n `geom_`. Utilizaremos `geom_point()` para hacer un diagrama de dispersi√≥n. 

```{r, fig.width = 5, fig.height = 4}
p + geom_point()
```


El mapeo de las propiedades est√©ticas se denomina *escalamiento* y depende del tipo de variable, las variables discretas (por ejemplo, genero, escolaridad, pa√≠s) se mapean a distintas escalas que las variables continuas (variables num√©ricas como edad, estatura, etc.), los *defaults* para algunos atributos son (estos se pueden modificar):


aes       |Discreta      |Continua  
----------|--------------|---------
Color (`color`)|Arcoiris de colores         |Gradiente de colores  
Tama√±o (`size`)  |Escala discreta de tama√±os  |Mapeo lineal entre el √°rea y el valor  
Forma (`shape`)    |Distintas formas            |No aplica
Transparencia (`alpha`) | No aplica | Mapeo lineal a la transparencia   

Los *_geoms_* controlan el tipo de gr√°fica:

```{r, fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
p + geom_smooth()
```

Podemos ver de inmediato que algunos de estos `geoms` hacen mucho m√°s que simplemente poner puntos en una cuadr√≠cula. Aqu√≠ `geom_smooth()` ha calculado una l√≠nea suavizada y la regi√≥n sombreada representa el error est√°ndar de la l√≠nea suavizada. Si queremos ver los puntos de datos y la l√≠nea juntos, simplemente agregamos `geom_point()` de nuevo como una capa adicional utilizando `+`:

```{r, fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
p <- ggplot(data = gapminder,
            mapping = aes(x = gdpPercap,
                          y=lifeExp))
p + geom_point() + geom_smooth()
```


El mensaje de la consola de R nos dice que la funci√≥n `geom_smooth()` est√° utilizando un m√©todo llamado gam, que en este caso significa que se ajusta a un modelo aditivo generalizado. Esto sugiere que tal vez haya otros m√©todos en `geom_smooth()`. Podemos intentar agregar `method = "lm"` (para "modelo lineal") como un argumento para `geom_smooth()`:


```{r, fig.width = 5, fig.height = 4}
p <- ggplot(data = gapminder,
            mapping = aes(x = gdpPercap,
                          y=lifeExp))
p + geom_point() + geom_smooth(method="lm")
```



Se puede agregar al mapeo del color de la l√≠nea el continente y del relleno de los puntos (fill) tambi√©n el continente para obtener una gr√°fica que nos d√© una idea m√°s general de como se tiene esta relaci√≥n por continente.



```{r, fig.width = 10, fig.height = 6}
p <- ggplot(data = gapminder,
            mapping = aes(x = gdpPercap,
                          y = lifeExp,
                          color = continent,
                          fill = continent))
p + geom_point() +
    geom_smooth(method='loess') +
    scale_x_log10()
```


<p class="espacio">
</p>

#### Un histograma de las muertes en Iraq

Iraq Body Count (IBC) mantiene la base de datos p√∫blica m√°s grande sobre muertes violentas de civiles desde la invasi√≥n en Iraq del 2003. Los datos de IBC provienen de informes de medios cruzados, de hospitales, morgue, ONG y cifras o registros oficiales.

Para mayor informaci√≥n puedes visitar <https://www.iraqbodycount.org/>.


Los datos los leemos con la funci√≥n `read_csv()` de la librer√≠a `readr`:
```{r}
ibc <- read_csv("datos/ibc-incidents-2016-8-8.csv")
glimpse(ibc)
```

Primero filtramos los incidentes en los que hubo al menos cinco fatalidades:


```{r}
ibc_fatalidades <- ibc %>%
  filter(Deaths_recorded >= 5)
```


Una forma f√°cil de dibujar un histograma es utilizando la geometr√≠a `geom_histogram()`:

```{r, message=FALSE, warning=FALSE}
ggplot(ibc_fatalidades, aes(x=Deaths_recorded)) +
  geom_histogram() +
  scale_x_log10()
```



#### Inglehart‚ÄìWelzel: un mapa cultural del mundo

Los te√≥ricos de la modernizaci√≥n de Karl Marx a Daniel Bell han sostenido que el desarrollo econ√≥mico trae cambios culturales penetrantes. Pero otros, desde Max Weber hasta Samuel Huntington, han afirmado que los valores culturales son una influencia duradera y aut√≥noma sobre la sociedad. 

En un art√≠culo de la ciencia pol√≠tica, los autores Inglehart y Welzel de la Universidad de Michigan, afirman que el desarrollo econ√≥mico est√° vinculado a cambios sistem√°ticos en los valores culturales. Utilizando los datos de la encuesta de valores mundiales WVS (World Values Survey), crearon dos √≠ndices: uno que pone √©nfasis en valores tradicionales y otro que pone √©nfasis en valores de supervivencia.

Caracter√≠sticas de valores tradicionales en una sociedad:

- fuerte sentimiento de orgullo nacional

- le da m√°s importancia a que un ni√±o aprenda obediencia y f√© religiosa en lugar de independencia y determinaci√≥n

- el aborta nunca es justificada

- fuerte sentido de orgullo nacional

- favorece m√°s el respeto por la autoridad.


Los valores seculares o racionales enfatizan lo opuesto.

Caracter√≠sticas de valores de supervivencia en una sociedad:

- le da prioridad a la econom√≠a sobre la calidad de vida

- se describe como no muy feliz

- a√∫n no ha firmado o jam√°s firmar√≠a una petici√≥n

- la homosexualidad nuna es justificada

- se debe ser muy cuidadoso al confiar en las personas.


Los valores de autoexpresi√≥n enfatizan lo opuesto.


<center>![](figuras/Culture_Map_2017.png)</center>

Ronald Inglehart en su art√≠culo de 1971 __The silent revolution in Europe. Intergenerational change in post-industrial societies.__ publicado en el __American Political Science Review__, propone una medida de los valores postmaterialistas de una sociedad. Esta medida se conoce como √≠ndice post-materialista de Inglehart (4-item) .

La siguiente pregunta de la encuesta es el punto de partida para medir el materialismo o el post-materialismo: "Si tuvieras que elegir entre las siguientes cosas, ¬øcu√°les son las dos que te parecen m√°s deseables?"

- Mantener el orden en la naci√≥n.

- Dando a la gente m√°s voz en importantes decisiones pol√≠ticas.

- La lucha contra el aumento de los precios.

- Proteger la libertad de expresi√≥n.

La medida se basa entonces en la observaci√≥n de que dos de las cuatro opciones, la primera y la tercera, se consideran como "preferencia hacia el valor adquisitivo en relaci√≥n con la protecci√≥n y adquisici√≥n de bienes". Si se eligen las dos opciones postmaterialistas, entonces la puntuaci√≥n es 3. Si se elige s√≥lo una opci√≥n post-materialista, entonces la puntuaci√≥n es 2, y de lo contrario es 1. Como todas las opciones podr√≠an ser deseables, la medida se relaciona con la "prioridad relativa" de las elecciones materialistas sobre la segunda y cuarta y aborda las concesiones que t√≠picamente conllevan las decisiones pol√≠ticas. La conceptualizaci√≥n del postmaterialismo a lo largo de un continuo unidimensional est√° cerca del concepto de la "jerarqu√≠a de necesidades" propuesta por Maslow.

```{r}
library(tidyverse)
factores_inglehart <- read_csv(file = "datos/factores_inglehart.csv")
glimpse(factores_inglehart)
```

#### Creando un ggplot

Para graficar `factores_inglehart`, ejecuta este c√≥digo para poner `survival_selfexpression` en el eje x (eje horizontal) y `traditional_secular` en el eje y (eje vertical):

```{r}
ggplot(data = factores_inglehart) + 
  geom_point(mapping = aes(x = survival_selfexpression, y = traditional_secular))
```

#### Mapeos: Aesthetics

> "The greatest value of a picture is when it forces us to notice what we
> never expected to see." --- John Tukey


En la gr√°fica de abajo, un grupo de puntos (en rojo) parece estar fuera de la tendencia lineal. Estos pa√≠ses tienen menores valores de supervivencia de lo que esperar√≠amos de acuerdo a sus mayores valores de tradicionalismo.

```{r, echo = FALSE}
ggplot(data = factores_inglehart, mapping = aes(x = survival_selfexpression, y = traditional_secular)) +
  geom_point() + 
  geom_point(data = dplyr::filter(factores_inglehart, survival_selfexpression > 0, traditional_secular < -0.5), colour = "red", size = 2.2)
```


Podemos formular la hip√≥tesis de que se trata de pa√≠ses latinoamericanos. Una forma de probar esta hip√≥tesis es con la variable `reg`. La variable `reg` del conjunto de datos `factores_inglehart` clasifica a los pa√≠ses de acuerdo a su regi√≥n geogr√°fica.


Podemos agregar una tercera variable, como `reg`, a un diagrama de dispersi√≥n bidimensional asign√°ndolo a un __aesthetic__ o mapeo. Un mapeo es una propiedad visual de los objetos en la gr√°fica. 

Un mapeo incluye cosas como el tama√±o, la forma o el color de los puntos. Puede mostrar un punto (como el que se muestra a continuaci√≥n) de diferentes maneras cambiando los valores de sus propiedades de mapeos. 


Aqu√≠ cambiamos los niveles de tama√±o, forma y color de un punto para hacer que el punto sea peque√±o, triangular o azul:

```{r, echo = FALSE, asp = 1/4}
ggplot() +
  geom_point(aes(1, 1), size = 20) +
  geom_point(aes(2, 1), size = 10) + 
  geom_point(aes(3, 1), size = 20, shape = 17) + 
  geom_point(aes(4, 1), size = 20, colour = "blue") + 
  scale_x_continuous(NULL, limits = c(0.5, 4.5), labels = NULL) + 
  scale_y_continuous(NULL, limits = c(0.9, 1.1), labels = NULL) + 
  theme(aspect.ratio = 1/3)
```

Podemos transmitir informaci√≥n sobre los datos mapeando los aesthetics en la gr√°fica a las variables del data frame. Por ejemplo, podemos asignar los colores de los puntos a la variable `reg` para revelar la regi√≥n de cada pa√≠s.



```{r}
ggplot(data = factores_inglehart) + 
  geom_point(mapping = aes(x = survival_selfexpression, y = traditional_secular, color=reg))
```


Para asignar una caracter√≠stica a una variable, asociamos el nombre del mapeo al nombre de la variable dentro de `aes()`. ggplot2 asignar√° autom√°ticamente un nivel √∫nico de dicha caracter√≠stica (o mapeo) a cada valor √∫nico de la variable, un proceso conocido como __escalamiento__. ggplot2 tambi√©n agregar√° una leyenda que explique qu√© niveles corresponden a qu√© valores.


Tambi√©n podr√≠amos agregar etiquetas:

```{r, echo=FALSE, results='hide', comment=NA, message=FALSE, warning=FALSE}
library(maptools)
etiquetar <- function(df, x, y, etiq = "etiq", size = 3.5){
  df <- as.data.frame(df)
  plot(df[, x], df[, y])
  orden <- pointLabel(df[, x], df[, y], df[, etiq], doPlot = TRUE,
    cex = 0.5 * size, xpd = TRUE)
  dev.off()
  df$a <- orden$x
  df$b <- orden$y
  df
}
set.seed(720528)
factores_inglehart_etiq <- etiquetar(factores_inglehart, "survival_selfexpression",
                         "traditional_secular", etiq = "country", size = 2.1)
```

```{r, fig.height=8, fig.width=10, message=FALSE, warning=FALSE, echo = FALSE}
ggplot(data = factores_inglehart_etiq,
       aes(x=survival_selfexpression,y=traditional_secular,color=reg,group=reg)) +
  geom_point(size = 2) +
  geom_text(aes(x = a, y = b, label = country), size = 4) +
  theme(legend.position = "bottom") +
  scale_color_manual("Region", values = RColorBrewer::brewer.pal(6,"Dark2")) + 
  ylab("Traditional/secular values") + 
  xlab("Survival/Self expression values")
```


#### Objetos geom√©tricos

¬øEn qu√© se parecen las siguiente dos gr√°ficas? 

```{r echo = FALSE, out.width = "50%", fig.align="default", message = FALSE}
ggplot(data = factores_inglehart) + 
  geom_point(mapping = aes(x = survival_selfexpression, y = traditional_secular))

ggplot(data = factores_inglehart) + 
  geom_smooth(mapping = aes(x = survival_selfexpression, y = traditional_secular), method = "loess")
```

Ambas gr√°ficas contienen la misma variable x, la misma variable y, y ambas describen los mismos datos. Pero las gr√°ficas no son id√©nticas. Cada una utiliza un objeto visual diferente para representar los datos. En la sintaxis de ggplot2, decimos que usan diferentes __geoms__.


Un __geom__ es un objeto geom√©trico que una gr√°fica utiliza para representar a los datos. La gente a menudo describe las gr√°ficas por el tipo de geometr√≠a que usa la gr√°fica. Por ejemplo, las gr√°ficas de barras usan geometr√≠as de barras, los gr√°ficos de l√≠nea utilizan geoms de l√≠nea, los boxplots usan geoms de boxplot, y as√≠ sucesivamente. Los diagramas de dispersi√≥n rompen la tendencia; Utilizan la geometr√≠a de punto. 

La gr√°fica de la izquierda utiliza el punto geom, y la gr√°fica de la derecha utiliza el geom de smooth, una l√≠nea ajustada a los datos. Para hacer las gr√°ficas mostradas arriba se puede utilizar el siguiente c√≥digo.


```{r eval = FALSE}
#izquierda
ggplot(data = factores_inglehart) + 
  geom_point(mapping = aes(x = survival_selfexpression, y = traditional_secular))

#derecha
ggplot(data = factores_inglehart) + 
  geom_smooth(mapping = aes(x = survival_selfexpression, y = traditional_secular), method = "loess")
```

Cada funci√≥n geom en ggplot2 toma un argumento `mapping`. Sin embargo, no todas las propiedades de __aesthetics__ funciona con cada geom. Podr√≠amos cambiar la forma de un punto, pero no la "forma" de una l√≠nea. Por otro lado, podr√≠amos establecer el tipo de l√≠nea de una l√≠nea. `geom_smooth()` dibujar√° una l√≠nea diferente, con un tipo de l√≠nea diferente, para cada valor √∫nico de la variable que se asigna al tipo de l√≠nea.

```{r, message = FALSE, warning=FALSE, comment=NA}
ggplot(data = factores_inglehart) + 
  geom_smooth(mapping = aes(x = survival_selfexpression, y = traditional_secular, linetype = reg), method = "loess", se = F, span = 1)
```



Aqu√≠ `geom_smooth()` separa los pa√≠ses en l√≠neas bas√°ndose en su valor de `reg` (regi√≥n geogr√°fica).


Podemos superponer las l√≠neas encima de los datos sin procesar y luego colore√°ndolo todo de acuerdo a `reg`.


```{r echo = FALSE, message = FALSE, warning=FALSE}
ggplot(data = factores_inglehart, mapping = aes(x = survival_selfexpression, y = traditional_secular, color = reg)) + 
  geom_point() +
  geom_smooth(mapping = aes(linetype = reg), method = "loess", se = F)
```


Para mostrar varios geoms en la misma gr√°fica, agregamos varias funciones geom a `ggplot()`:

```{r, message = FALSE}
ggplot(data = factores_inglehart) + 
  geom_point(mapping = aes(x = survival_selfexpression, y = traditional_secular)) +
  geom_smooth(mapping = aes(x = survival_selfexpression, y = traditional_secular), method = "loess")
```


Este c√≥digo genera la misma gr√°fica que el c√≥digo anterior:

```{r, eval = FALSE}
ggplot(data = factores_inglehart, mapping = aes(x = survival_selfexpression, y = traditional_secular)) + 
  geom_point() + 
  geom_smooth(method = "loess")
```

Si colocan asignaciones en una funci√≥n `geom`, `ggplot2` las tratar√° como asignaciones locales para cada capa, de tal forma que usar√° estas asignaciones para extender o sobrescribir las asignaciones globales _para esa capa solamente_. Esto hace posible visualizar elementos diferentes en diferentes capas.

```{r, message = FALSE}
ggplot(data = factores_inglehart, mapping = aes(x = survival_selfexpression, y = traditional_secular)) + 
  geom_point(mapping = aes(color = reg)) + 
  geom_smooth(method = "loess")
```


### Gr√°fica de l√≠nea

La base de datos Global Terrorism Database (GTD) es una base de datos abierta que incluye informaci√≥n de los eventos terroristas en todo el mundo desde 1970 hasta el 2015. Esta base de dato se actualiza cada a√±o con los datos del a√±o anterior. A diferencia de muchas otras fuentes de datos de eventos terroristas, GTD incluye datos sistem√°ticos sobre incidentes terroristas tanto nacionales e internacionales que han ocurrido durante este per√≠odo de tiempo y ahora incluye m√°s de 150 mil casos.


Para mayor informaci√≥n puedes visitar <https://www.start.umd.edu/gtd/>.


Comenzamos leyendo los datos de ataques terroristas por a√±o:

```{r, message=FALSE, warning=FALSE, results='hide', comment=NA}
ataques_por_anio <- read_csv("datos/gtd_ataques_por_anio.csv")
```

Ahora supongamos que queremos hacer una gr√°fica del n√∫mero de ataques terroristas en forma de l√≠nea de tiempo. Para lograr esto, s√≥lo necesitamos utilizar la geometr√≠a `geom_line()`:

```{r}
ggplot(data = ataques_por_anio, aes(x=iyear, y = num_ataques)) +
  geom_line()
```

### Gr√°fica de barras

Podemos utilizar gr√°ficas de barras y asociar la caracter√≠stica de `fill` tambi√©n a la variable de a√±o:

```{r}
ggplot(data = ataques_por_anio, aes(x = iyear, y = num_ataques, fill = iyear)) +
  geom_bar(stat = 'identity') +
  ggtitle('Ataques terroristas de 1970 a 2014') +
  xlab('A√±o')
```


#### Un breve panorama sociopol√≠tico del mundo presentado a trav√©s de gr√°ficas:

```{r}
polity <- read_rds("datos/polity.rds")
ggplot(data = polity, aes(x = year)) + 
    geom_line(aes(y = numdems, colour = "numdems"), lwd = 1) + 
    geom_line(aes(y = numauts, colour = "numauts"), lwd = 1) +
    xlab("Year") + 
    ylab("Count") +
    ggtitle("N√∫mero de democracias y autocracias, 1800-2012") +
    scale_color_manual(name = "Regime Type",
                       labels = c(numdems="Democracias", numauts = "Autocracias"),
                       values=c(numdems=4,numauts=2))
```

```{r, message=FALSE, comment=NA, results=FALSE}
library(rgdal)
wrld <- readOGR("shps", "countries")
wrld_df <- fortify(wrld, region="name")
```

```{r, message=F, warning=FALSE, comment=NA, results='hide'}
autocracies <- read_rds('datos/autocracies.rds')
autocracies_2012 <- autocracies %>% filter(year == 2012)
autocracies_mapa_2012 <- left_join(wrld_df, autocracies_2012, by = c("id"="country"))
```


```{r, fig.align="center", fig.height=6, fig.width=10, message=FALSE, warning=FALSE}
ggplot(autocracies_mapa_2012, aes(x=long, y = lat)) +
  geom_polygon(aes(group = group, fill = as.factor(regime_r)), color = "black")
```


### Diagrama de caja y brazos

Vamos a utilizar un nuevo conjunto de datos sobre vuelos que salen de Nueva York en 2013. Este conjunto de datos contiene todos los 336,776 vuelos que salieron de Nueva York en 2013. Los datos provienen de los EE.UU. [Bureau of Transportation Statistics] (http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&Link=0), y est√°n documentados en ?flights.


```{r, message=FALSE, warning=FALSE}
library(nycflights13)
glimpse(flights)
```


Supongamos que deseamos analizar el retraso en las llegadas por aereol√≠nea. Supongamos, adem√°s, que nos interesa el retraso promedio.

```{r}
flights_2 <- flights %>%
  group_by(carrier) %>%
  summarise(arr_delay_media = mean(arr_delay, na.rm = T))
ggplot(flights_2, aes(x = carrier, y = arr_delay_media)) +
  geom_bar(stat = 'identity')
```

Si agregamos las barras de error que suelen ser utilizadas en gr√°ficas de barras que representan medias, en realidad no logramos mucho.

```{r}
flights_3 <- flights %>%
  group_by(carrier) %>%
  summarise(arr_delay_media = mean(arr_delay, na.rm = T),
            se = sd(arr_delay, na.rm = T))
ggplot(flights_3, aes(x = carrier, y = arr_delay_media)) +
  geom_bar(stat = 'identity') + 
  geom_errorbar(aes(ymin = arr_delay_media - se, ymax = arr_delay_media + se),
                width = .3)
```

Observamos que hay mucha varianza. Una alternativa √∫til para entender el fen√≥meno es utilizar el diagrama de caja y brazos.

```{r, message=FALSE, warning=FALSE}
ggplot(flights, aes(x = carrier, y = arr_delay)) + 
  geom_boxplot() 
```

Tal vez sea adecuado utilizar una transformaci√≥n, aunque esto siempre debe hacerse con cautela.

```{r, message=FALSE, warning=FALSE}
ggplot(flights, aes(x = carrier, y = arr_delay + abs(min(flights$arr_delay, na.rm = T)))) + 
  geom_boxplot() +
  scale_y_log10(name = "Arrival delay (min) in log scale: log(x+c)")
```

Por √∫ltimo, generalmente es apropiado ordenar los diagramas de caja y brazos por la mediana si la variable que se est√° representando en el eje $x$ no es de tipo ordinal.

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(iris, aes(x = Species, y = Sepal.Width)) + geom_boxplot()
```

```{r}
ggplot(iris, aes(x = reorder(Species, Sepal.Width, FUN = median), y = Sepal.Width)) + geom_boxplot()
```


### Peque√±os m√∫ltiplos

Supongamos que nos interesa analizar el tiempo de retraso en la salida de los vuelos a lo largo de la hora del d√≠a en que salen para algunas aerol√≠neas m√°s conocidas:

```{r, message=FALSE, warning=FALSE}
flights_4 <- flights %>% filter(carrier %in% c("AA","B6","DL","UA","VX","WN"))
ggplot(flights_4, aes(x = hour, y = dep_delay, color = carrier, group = carrier)) +
  geom_smooth()
```

Existe una opci√≥n diferente, denominada *peque√±os m√∫ltiplos* por Tufte. En ggplot basta con usar la funci√≥n `facet_grid(.~)` como una capa adicional:

```{r, message=FALSE, warning=FALSE}
ggplot(flights_4, aes(x = hour, y = dep_delay)) +
  geom_smooth() +
  facet_grid(. ~ carrier)
```

De acuerdo con Tufte (Envisioning Information, p√°gina 67):

> En el coraz√≥n del razonamiento cuantitativo hay una sola pregunta: _¬øComparado con qu√©?_
> Los peque√±os m√∫ltiplos, multivariados y abundantes en datos, responden la pregunta directamente porque visualmente refuerzan las comparaciones de cambios, las diferencias entre objetos, y el alcance de las alternativas. Para una amplia gama de visualizci√≥n de datos, los peque√±os m√∫ltiplos son generalmente la mejor soluci√≥n de dise√±o.

### Mapas

```{r, echo=F, message=FALSE, warning=FALSE, comment=NA, results='hide'}
library(ggplot2)
library(dplyr)
library(scales)
library(sp)
library(rgeos)
library(maptools)
library(rgdal)
library(ggmap)
library(gridExtra)
```

Gran parte de los datos que se estudian en estad√≠stica espacial consisten en
observaciones en la Tierra por lo que es importante realizar mapas donde 
grrafiquemos las observaciones, o realizar mapas que incorporen estimaciones de 
un modelo. Los mapas pueden ser parte del an√°lisis exploratorio o pueden servir 
para evaluar el ajuste de un modelo.

### Elipses, datums, proyecciones

1. **Elipse:** Describe la forma de la Tierra, es una aproximaci√≥n que no
ajusta a la perfecci√≥n. Existen distintos elipsoides, algunos est√°n dise√±ados
para ajustar toda la Tierra (WGS84, GRS80) y algunos ajustan √∫nicamente por
regiones (NAD27). Los locales son m√°s precisos para el √°rea para la que fueron
dise√±ados pero no funcionan en otras partes del mundo.

```{r}
projInfo(type = "ellps")[1:10, ]
```

2. **Datum:** Define un punto de origen para el sistema de coordenadas de la 
Tierra y la direcci√≥n de los ejes. El datum define el elipsoide que se usar√°
pero el sentido contrario no es cierto.

```{r}
projInfo(type = "datum")
```

3. **Proyecci√≥n:** Proyectar el elipsoide en un espacio de dos dimensiones. Es
decir pasar de longitud y latitud en el elipsoide a coordenadas de un mapa, esto
conlleva necesariamente una distorsi√≥n de la superficie. La estrategia usual es
utilizar _superficies de desarrollo_ y despu√©s aplanar la superficie. Todas las proyecciones inducen alguna distorsi√≥n y las proyecciones de los mapas ser√°n 
diferentes.

<center><img src="./figuras/mapa_Tierra.png" style="width: 500px;"/></center>

Las distorsiones resultan en p√©rdidas de informaci√≥n que pueden ser en √°rea, 
forma, distancia o direcci√≥n. Por ejemplo _Mercator_ preserva direcci√≥n y es 
√∫til para navegaci√≥n: 

```{r, echo=FALSE}
detachAllPackages <- function() {

  basic.packages <- c("package:stats","package:graphics","package:grDevices","package:utils","package:datasets","package:methods","package:base")

  package.list <- search()[ifelse(unlist(gregexpr("package:",search()))==1,TRUE,FALSE)]

  package.list <- setdiff(package.list,basic.packages)

  if (length(package.list)>0)  for (package in package.list) detach(package, character.only=TRUE)

}

detachAllPackages()
```


```{r}
library(ggplot2)
states <- map_data("state")
usmap <- ggplot(states, aes(x=long, y=lat, group=group)) +
  geom_polygon(fill="white", colour="black")
usmap + coord_map("mercator")
```

Por su parte _Azimuthal Equal Area_ preserva area pero no direcci√≥n:

```{r}
usmap + coord_map("azequalarea")
```
<center><img src="./figuras/aea.png" style="width: 500px;"/></center>

En particular en investigaci√≥n es com√∫n usar _Universal Transverse Mercator 
(UTM)_ porque preserva √°ngulos y direcci√≥n pero distorsiona distancia. Para
minimizar la distorsi√≥n se divide la Tierra en 60 regiones y utiliza una 
proyecci√≥n (de secantes) en cada una.

<center><img src="./figuras/utm.png" style="width: 500px;"/></center>

En R podemos ver la lista de proyecciones con la siguiente instrucci√≥n:

```{r, message=FALSE, warning=FALSE}
library(rgdal)
# 135 proyecciones distintas
projInfo(type="proj")[1:20, ]
```

Es posible trabajar con datos no proyectados (longitud/latitud) pero se 
requieren m√©todos para medir distancias: gran c√≠rculo, naive euclideana, 
o cordal.

### Sistemas de referencia de coordenadas (CRS)

Los CRS nos dan una manera est√°ndar de describir ubicaciones en la Tierra. Si 
combinamos informaci√≥n de distintos CRS debemos transformarlos para poder 
alinear la informaci√≥n.

En R, la notaci√≥n que se utiliza para describir un CRS es proj4string de la 
librar√≠a [PROJ.4](https://trac.osgeo.org/proj/) y se ven como:

+init=epsg:4121 +proj=longlat +ellps=GRS80 +datum=GGRS87 +no_defs +towgs84=-199.87,74.79,246.62

#### Shapefiles

Un _shapefile_ es un grupo de archivos que contienen geometr√≠as e informaci√≥n de 
acuerdo a un est√°ndar especificado por el Insituto de Investigaci√≥n en Sistemas 
de Ecosistemas (ESRI). Nosotros tenemos los siguientes grupos de archivos 
(para pa√≠ses): 

* countries.shp: es el archivo principal y contiene la geometr√≠a correspondiente.

* countries.dbf: es la base de datos y almacena la informaci√≥n de los atributos de 
los objetos 

* countries.shx: almacena el √≠ndice de geometr√≠as de los pa√≠ses.

* countries.prj (opcional): informaci√≥n del sistema de referencia de coordenadas.

Los shapefiles suelen tener asociada una proyecci√≥n.

```{r}
ogrInfo(dsn = "./shps", layer = "municipio")
ogrInfo(dsn = "./shps", layer = "entidad")
```

En el caso de la proyecci√≥n en los shapes de Municipios se us√≥
[North America Lambert Conformal Conic Projection](http://en.wikipedia.org/wiki/Lambert_conformal_conic_projection).

```{r}
mun_shp <- readOGR("shps" , "municipio")
mun_shp@proj4string
```

Veamos las librer√≠as que usaremos

```{r, eval=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(sp)
library(rgeos)
library(maptools)
library(rgdal)
library(ggmap)
library(gridExtra)
```

Usamos la funci√≥n readOGR para leer los archivos de estados.

```{r, message=FALSE, warning=FALSE, comment=NA, results='hide'}
edo_shp <- readOGR("shps" , "entidad")
```

el "shps" indica que los archivos est√°n en el directorio shps.

Notemos que el objeto edo_shp no es un data frame,

```{r}
class(edo_shp)
```

Lo podemos graficar directamente con plot.

```{r, eval=FALSE}
plot(edo_shp)
```

<center><img src="./figuras/plot_edo_shp.png" style="width: 500p4;"/></center>


pero para poder graficarlo con ggplot debemos convertirlo en data frame.

Formamos el data frame (con fortify) que convierte los pol√≠gonos en 
puntos, les asigna el id (NOM\_ENT) correspondiente, y asigna tambi√©n un 
_grupo_ que indica  a que pol√≠gono corresponde cada punto.

```{r}
edo_df <- fortify(edo_shp, region = "CVE_ENT")
class(edo_df)
head(edo_df)
```
Ya estamos listos para graficar, usaremos la geometr√≠a pol√≠gono utilizando la proyecci√≥n de Mercator:

```{r, eval = FALSE}
ggplot(data = edo_df, aes(long, lat, group=group)) + 
  geom_polygon(colour='darkgrey', fill='white') +
  coord_map(projection="mercator") +
  theme_nothing()
```

```{r, echo = FALSE, eval = FALSE}
g <- ggplot(data = edo_df, aes(long, lat, group=group)) +
  geom_polygon(colour='darkgrey', fill='white') +
  coord_map(projection="mercator") +
  theme_nothing()
ggsave(filename = "figuras/mexico_mercator.png", plot = g, width = 10, height = 6)
```

<center>![](figuras/mexico_mercator.png)</center>

Las proyecciones azimutales est√°n centradas en el Polo Norte. Los paralelos son c√≠rculos conc√©ntricos. Los meridianos son l√≠neas radiales igualmente espaciadas.

Utilizando la proyecci√≥n azimutal de √°reas iguales:

```{r, eval=FALSE}
ggplot(data = edo_df, aes(long, lat, group=group)) +
  geom_polygon(colour='darkgrey', fill='white') +
  coord_map(projection="azequalarea") +
  theme_nothing()
```

```{r, echo=FALSE, eval = FALSE}
g <- ggplot(data = edo_df, aes(long, lat, group=group)) + 
  geom_polygon(colour='darkgrey', fill='white') +
  coord_map(projection="azequalarea") +
  theme_nothing()
ggsave(filename = "figuras/mexico_azimutal.png", plot = g, width = 10, height = 6)
```

<center>![](figuras/mexico_azimutal.png)</center>


#### A√±adir variables al mapa

Nuestro objetivo final es hacer mapas para representar una variable. Veamos
c√≥mo har√≠amos para representar el √≠ndice de carencias.

```{r}
library(readr)
indice <- read_csv("datos/indice_carencias_conapo_2010.csv")
```

**Filtramos** los datos para las entidades del centro del pa√≠s:

```{r}
library(dplyr)
centro <- indice %>% 
  filter(NOM_ABR %in% c("DF", "Mex.", "Mor."))
```

Cargamos los datos de los pol√≠gonos a nivel municipio y convertimos a data frame utilizando `CVEGEO` como identificador de la regi√≥n:

```{r}
mun_shp <- readOGR("shps", "municipio")
mun_df <- fortify(mun_shp, region = "CVEGEO")
```


Para incluirlas en el mapa a√±adimos las variables de inter√©s a la base de datos
mun_df. Para este ejemplo graficaremos √∫nicamente una regi√≥n. Podemos crear
el subconjunto directamente del objeto _SpatialPolygonsDataFrame_ pero en 
este ejemplo filtraremos la base de datos _data.frame_.

```{r, message=FALSE, warning=FALSE}
mun_ind <- mun_df %>%
  mutate(CVE = id) %>%
  left_join(indice, by = "CVE") %>% 
  filter(NOM_ABR %in% c("DF", "Mex.", "Mor."))

ggplot() + 
  geom_polygon(data = mun_ind, aes(long, lat, group = group, fill = indice)) +
  labs(title = "√çndice de carencias", fill = "√çndice") +
  coord_fixed()
```

En el siguiente mapa los colores son a nivel municipio pero dibujamos las 
fronteras a nivel estado para evitar que los bordes opaquen los datos.

```{r, message=FALSE, warning=FALSE, eval=FALSE}
mun_ind <- mun_df %>%
  mutate(CVE = id) %>%
  left_join(indice, by = "CVE") 

library(ggmap)
library(scales)
ggplot() + 
  geom_polygon(data = mun_ind, aes(long, lat, group = group, fill = indice)) +
  geom_polygon(data = edo_df, aes(x = long, y = lat, group = group),
    fill = NA, color = "darkgray", size = 0.25) +
  labs(title = "√çndice de carencias", fill = "√çndice") +
  theme_nothing(legend = TRUE) + #fondo blanco
  guides(fill = guide_legend(reverse = TRUE)) +
  scale_fill_distiller(palette = "GnBu", breaks = pretty_breaks(n = 10)) + #paleta 
  coord_map()
```
<center>![](figuras/carencias_municipal.png)</center>

### 6000 a√±os de urbanizaci√≥n global desde 3700 aC hasta 2000 dC

En junio del 2016 se public√≥ un art√≠culo en la revista Nature. Lo m√°s interesante es que se trata del primer esfuerzo que se ha hecho en proporcionar datos completos del crecimiento de las ciudades del mundo desde el 3700 aC. Los autores (Meredith Reba, Femke Reitsma y Karen Seto) escriben en su art√≠culo:

<p class="espacio">
</p>

<div style="text-align: center;">*¬øC√≥mo se distribuyeron las ciudades a nivel mundial en el pasado? ¬øCu√°ntas personas viv√≠an en estas ciudades? Para entender la urbanizaci√≥n de hoy en d√≠a, debemos entender las tendencias hist√≥ricas a largo plazo. Sin embargo, hasta la fecha no existe un registro exhaustivo de datos poblacionales espacialmente expl√≠citos, hist√≥ricos y urbanos a escala mundial. Aqu√≠, desarrollamos el primer conjunto de datos de asentamientos urbanos entre 3700 aC y 2000 dC, mediante la digitalizaci√≥n, transcripci√≥n y geocodificaci√≥n de datos hist√≥ricos de poblaciones urbanas, datos arqueol√≥gicos y censales previamente publicadas por Chandler y Modelski.*</div>

<p class="espacio">
</p>

Para mayor informaci√≥n puedes visitar <http://www.nature.com/articles/sdata201634>.


Podemos utilizar estos datos para hacer una gr√°fica del crecimiento de las ciudades en cada siglo desde 3700 aC hasta el 2000 dC. En los datos cada unidad observacional consituye una ciudad en un a√±o espec√≠fico y las variables son el nombre de la ciudad, el pa√≠s, su latitud y longitud, el a√±o y la poblaci√≥n.

Primero leemos los datos:

```{r, warning=FALSE}
library(tidyverse)
cities <- read_csv('datos/historical_population.csv')
```

Estos datos tienen un total de 1739 ciudades distintas. Es necesario cargar un mapa del mundo para representar la poblaci√≥n de las ciudades sobre el mapa. Para esto se utilizan **shapefiles**.

Veamos c√≥mo se cargan los datos para los mapas:

```{r, message=FALSE, comment=NA, results=FALSE}
library(rgdal)
wrld <- readOGR("shps", "countries")
```

el "shps" indica que los archivos est√°n en el directorio `shps`.

Notemos que el objeto wrld no es un data frame,

```{r}
class(wrld)
```

Lo podemos graficar directamente con plot.

```{r}
plot(wrld)
```

Para poder graficarlo con **ggplot** debemos convertirlo en data frame.

Formamos el data frame (con fortify) que convierte los pol√≠gonos en 
puntos, les asigna el id (name) correspondiente al nombre de cada pa√≠s, y asigna tambi√©n un 
_grupo_ que indica a qu√© pol√≠gono corresponde cada punto.

```{r}
wrld_df <- fortify(wrld, region="name")
class(wrld_df)
head(wrld_df)
```

```{r, message=FALSE, warning=FALSE}
library(ggthemes)
base<- ggplot() + geom_map(data=wrld_df, map=wrld_df, aes(x=long, y=lat, map_id=id, group=group),fill="gray67") + theme_map()
```
Mostramos el mapa base:

```{r}
print(base)
```

Ahora es necesario trazar las ciudades en una capa superior al mapa con los c√≠rculos escalados por el tama√±o de la ciudad.

Vamos a **filtrar** las ciudades correspondientes al a√±o 2000 utilizando la funci√≥n **filter()**:

```{r}
cities_2000 <- cities %>%
  filter(Year == 2000)
```

El data frame resultante consta de 1695 ciudades √∫nicas y un total de 1825 observaciones:

```{r}
glimpse(cities_2000)
```


<br>

#### Pipeline


La idea de *pipeline* intenta hacer el desarrollo de c√≥digo m√°s f√°cil, en menor tiempo, f√°cil de leerlo, y por lo tanto, m√°s f√°cil mantenerlo.

En el an√°lisis de datos es com√∫n hacer varias operaciones y se vuelve dif√≠cil leer y entender el c√≥digo. La dificultad radica en que usualmente los par√°metros se asignan despu√©s del nombre de la funci√≥n usando `()`. 

La forma en que esta idea logra hacer las cosas m√°s faciles es con el operador **forward pipe** `%>%`que env√≠a un valor a una expresi√≥n o funci√≥n. Este cambio en el orden funciona como el par√°metro que precede a la funci√≥n es enviado ("piped") a la funci√≥n. Es decir, supongamos `x` es una valor y  sea `f` una funci√≥n, entonces **`x %>% f` es igual a `f(x)`.**


Por ejemplo, sea f(x) la funci√≥n de probabilidad de la distribuci√≥n normal con media $\mu = 0$ y desviaci√≥n est√°ndar $\sigma = 1$:
\[
f(x) = \frac{ 1 }{\sqrt{2\pi}} e^{- \frac{1}{2} x^2}
\]

```{r magrttrpipe}
f <- function(x){
  exp(-(x^2)/2)/sqrt(2*pi)
} 
# Con operador pipe
0 %>% f
```

que de forma tradicional se realiza:
```{r magrttr}
# Forma tradicional
f(0)
```

En resumen `%>%` funciona:

<img src="figuras/pipe-function.png" width="400px"/>

**Nota:** El shortcut del pipe `%>%` es command/ctrl + shift + m



> `Ejercicio`:
>
>
> ¬øQu√© hace el siguiente c√≥digo? ¬øQu√© hace `.`?

```{r, eval = F}
df <- data_frame(
  x = runif(5),
  y = rnorm(5)
)
df %>% .$x
df %>% 
  ggplot(data = ., aes(x = x, y = y)) + 
    geom_point()
```


<br>

Regresando a la construcci√≥n de nuestro mapa de la poblaci√≥n en el mundo, establecemos primero los puntos de corte y las etiquetas para el tama√±o de los c√≠rculos:

```{r}
size_breaks<-c(10000,50000,100000,500000,1000000,5000000,10000000)
labs_breaks <- c("10K","50k","100K","500k","1M","5M","10M+")
```

Tanto `size_breaks` como `labs_breaks` son vectores que se van a utilizar para definir la escala (tama√±o) de los c√≠rculos de acuerdo a la densidad poblacional de cada ciudad.


Ahora graficamos agregando una capa de puntos a la gr√°fica base que ten√≠amos anteriormente:

```{r}
base +
  geom_point(data=cities_2000, aes(x=Longitude, y=Latitude, size=Pop), 
             colour="darkmagenta",alpha=0.3, pch=20) +
    scale_size(breaks=size_breaks,range=c(2,14), 
               limits=c(min(cities_2000$Pop),max(cities_2000$Pop)),
               labels=c("10K","50k","100K","500k","1M","5M","10M+")) +
    coord_map("mollweide", ylim=c(-55,80),xlim=c(-180,180))
```

Se puede producir una gr√°fica para cada siglo y crear un gif con las gr√°ficas resultantes:

![](figuras/world_population.gif)

### Otros ejemplos


<!-- #### Ejemplo con leaflet -->
```{r, message=FALSE, warning=FALSE, echo=FALSE, eval=FALSE}
#devtools::install_github('rstudio/leaflet')
library(leaflet)
library(maps)
library(rgdal)
library(RColorBrewer)

# Read data
url.d <- 'https://ourworldindata.org/wp-content/uploads/datamaps/AgeOfDemocracies2007/AgeOfDemocracies2007.csv'
df.democracies <- read_csv(url.d, col_types = 'ci')

# Read map
# "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_countries.zip"
countries <- readOGR(dsn = "shps", 
                     layer = "ne_50m_admin_0_countries", 
                     encoding = "UTF-8",
                     verbose = FALSE)

# Merge shapefile and data
leafmap <- merge(countries, 
                 df.democracies, 
                 by.x = "ISO_A3", 
                 by.y = "ISO",                    
                 sort = FALSE)
# Remove NA's
leafmap <- leafmap[!is.na(leafmap@data$Democduration) ,]

# Leaflet
popup_dat <- paste0("<strong>Pa√≠s: </strong>", 
                    leafmap$NAME, 
                    "<br><strong>Valor democr√°tico: </strong>", 
                    leafmap$Democduration)
pal <- colorBin(
  palette = "BuPu",
  domain = leafmap$Democduration, 9, pretty=FALSE)

leaflet(data = leafmap) %>%
  addProviderTiles("MapBox", options=providerTileOptions(id = "mapbox.light",accessToken="")) %>%
  #setView(0, 0, zoom = 2) %>%
  addPolygons(fillColor = ~pal(leafmap[['Democduration']]), 
              fillOpacity = 0.8, 
              smoothFactor = 0.1, 
              color = "white",
              weight = 0.5,
              popup = popup_dat)
```



#### Narrativa gr√°fica de espacio y tiempo

Regresemos a la gr√°fica de Minard:

![](figuras/Minard.png)

<p class="espacio">
</p>

Una manera efectiva de capturar mayor poder en la informaci√≥n que transmite una serie de tiempo es agregando dimensiones espaciales al dise√±o de la gr√°fica. La gr√°fica de Minard, como la describe E.J. Marey, parece "desafiar la pluma del historiador con su brutal elocuencia", la combinaci√≥n de datos del mapa, y la serie de tiempo, dibujados en 1869, "retratan una secuencia de p√©rdidas devastadoras que sufrieron las tropas de Napole√≥n en 1812". Comienza en la izquierda, en la frontera de Polonia y Rusia, cerca del r√≠o Niemen. La l√≠nea gruesa dorada muestra el tama√±o de la Gran Armada (422,000) en el momento en que invad√≠a Rusia en junio de 1812. 

El ancho de esta banda indica el tama√±o de la armada en cada punto del mapa. En septiembre, la armada lleg√≥ a Mosc√∫, que ya hab√≠a sido saqueada y dejada des√©rtica, con s√≥lo 100,000 hombres. 

El camino del retiro de Napole√≥n desde Mosc√∫ est√° representado por la l√≠nea oscuara (gris) que est√° en la parte inferior, que est√° relacionada a su vez con la temperatura y las fechas en el diagrama de abajo. Fue un invierno muy fr√≠o, y muchos se congelaron en su salida de Rusia. Como se muestra en el mapa, cruzar el r√≠o Berezina fue un desastre, y el ej√©rcito de Napole√≥n logr√≥ regresar a Polonia con tan s√≥lo 10,000 hombres. 

Tambi√©n se muestran los movimientos de las tropas auxiliaries, que buscaban proteger por atr√°s y por la delantera mientras la armada avanzaba hacia Mosc√∫. La gr√°fica de Minard cuenta una historia rica y cohesiva, coherente con datos multivariados y con los hechos hist√≥ricos, y que puede ser m√°s ilustrativa que tan s√≥lo representar un n√∫mero rebotando a lo largo del tiempo.

Quiz√°s sea la mejor gr√°fica estad√≠stica que jam√°s se haya elaborado.

<p class="espacio">
</p>

Para comenzar a hacer nuestra gr√°fica, primero es necesario **importar** los datos:
```{r, message=FALSE, warning=FALSE}
troops <- read_csv(file = 'datos/troops.csv')
cities <- read_csv(file = 'datos/cities.csv')
temps <- read_csv(file = 'datos/temps.csv')
```


<p class="espacio">
</p>

Veamos c√≥mo es la informaci√≥n que se tiene en `troops`:

```{r, message=FALSE, warning=FALSE}
glimpse(troops)
```

<p class="espacio">
</p>

Y la tabla de temperaturas, `temps`, tiene la siguiente estructura:

```{r, message=FALSE, warning=FALSE}
glimpse(temps)
```

<p class="espacio">
</p>

Comenzamos viendo c√≥mo graficar el diagrama de la parte inferior de la gr√°fica de Minard:

<p class="espacio">
</p>

```{r, fig.height=3, fig.width=10, message=FALSE, warning=FALSE}
ggplot(data = temps, mapping = aes(x = long, y = temp)) +
  geom_line() +
  geom_text(mapping = aes(label = paste(day,month)), hjust = 0.1, vjust = 1.5) +
  scale_x_continuous(limits = c(24, 39)) +
  scale_y_continuous(limits = c(-35,0),breaks = c(-30,-20,-10,0))
```


<p class="espacio">
</p>

Luego hacemos la gr√°fica del camino del ej√©rcito:



```{r, fig.height=5, fig.width=10, message=FALSE, warning=FALSE}
ggplot(cities, aes(x = long, y = lat)) +
  geom_path(data=troops,aes(size = survivors, colour = direction, group = group)) +
  geom_point() +
  geom_text(aes(label = city), hjust=0, vjust=1, size=3) +
  scale_colour_manual(values = c("bisque2","grey50")) +
  scale_x_continuous(limits = c(24, 39))
```

<p class="espacio">
</p>


Se puede hacer una gr√°fica como la que se muestra a continuaci√≥n:

```{r, fig.height=6.5, fig.width=10, comment = NA, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggmap)
library(rgdal)
library(scales)
library(gridExtra)
library(gtable)
library(grid)

theme_minard <- theme(
    panel.background = element_rect(fill="white"),
    panel.border = element_blank(),
    legend.key = element_rect(fill="white"),
    legend.key.size = unit(3, "line"),
    axis.text.y = element_text(colour="black"),
    axis.text.x = element_text(colour="black"),
    text = element_text(size=12, family="Times")
    )

p1 <- ggmap(read_rds("datos/sq_map.rds")) +
  geom_path(data = troops,
            mapping = aes(x = long, y = lat, size = survivors,
                          color = direction, group = group),
	          lineend = "square", linejoin = "bevel") +
  geom_text(data = cities, mapping = aes(x = long, y = lat, label = city),
            size = 3, color = "black", family="Times", fontface="italic",
            hjust=0, vjust=-1) +
  geom_point(data = cities,
             mapping = aes(x = long, y = lat), colour = "black", size=3) +
  coord_map(xlim = c(22.6,38.4), ylim = c(53.93,55.97)) +
  xlab(NULL) + ylab("Latitude") +
  scale_size(range = c(1, 12),
                  breaks = c(90000, 50000, 10000, 4000),
                  labels = c(90000, 50000, 10000, 4000)) +
  scale_colour_manual(values = c("bisque2", "grey50")) +
  theme_minard +
  scale_x_continuous(breaks = c(25,30,35)) +
  theme(legend.position = "top")


p2 <- ggplot(data = temps, mapping = aes(x = long, y = temp)) +
  geom_line() +
  geom_text(aes(label = paste(day,month)), size = 3, family="Times",
            fontface="italic",  hjust = 0.1, vjust=1.5) +
  theme_minard +
  theme(panel.grid.major = element_line(size=.2,colour="black")) +
  xlab("Longitude") + ylab("Temp√©rature") +
  scale_x_continuous(limits = c(23.4, 37.6), breaks = c(25,30,35)) +
  scale_y_continuous(limits = c(-35,0),breaks = c(-30,-20,-10,0))

grid.arrange(p1, p2, widths = c(10), heights = c(6,1.5), ncol = 1)
```

#### El Siglo XVIII
√âste es un ejemplo m√°s complejo que muestra c√≥mo producir un mapa de los flujos de transporte del siglo XVIII. Los datos se obtuvieron del proyecto CLIWOC y representan una muestra de registros de barcos. Estamos usando una muestra muy peque√±a. El ejemplo se ha elegido para demostrar una gama de capacidades dentro de ggplot2 y las formas en que pueden aplicarse para producir mapas de alta calidad con s√≥lo unas pocas l√≠neas de c√≥digo.

Para mayor informaci√≥n puedes visitar <http://pendientedemigracion.ucm.es/info/cliwoc/>. El an√°lisis original se encuentra en Brunsdon (2015).

Si nos fijamos en las primeras l√≠neas de bdata vemos que hay 7 variables por cada observaci√≥n que representa un solo punto en el curso de los barcos. Tambi√©n se incluyen el a√±o del viaje y la nacionalidad del barco. Las 3 √∫ltimas columnas son identificadores que se utilizan m√°s adelante para agrupar los puntos de coordenadas en las rutas.

Primero leemos los datos:

```{r, message=F, results='hide', comment=NA}
library(tidyverse)
library(rgdal)
library(png)

wrld <- readOGR("shps", "countries")
btitle <- readPNG("figuras/brit_titles.png")
compass <- readPNG("figuras/windrose.png")
bdata <- read.csv("datos/british_shipping_example.csv")
```

Se sugiere ejecutar estas l√≠neas en un script de R en RStudio y ver los datos haciendo click en el nombre de la base de datos `bdata` en la ventana de Environment.


Primero visualizamos el mapa:
```{r}
wrld.f <- fortify(wrld, region="sov_a3")
ggplot(wrld.f, aes(x = long, y = lat)) +
  geom_polygon(aes(group=group),size = 0.1,colour="black",fill="wheat",data=wrld.f,alpha=1)
```

El c√≥digo cortado a continuaci√≥n crea la capa de parcela que contiene las rutas de env√≠o. La funci√≥n `geom_path()` se utiliza para poner en otra capa las coordenadas en las rutas. Dentro de la funci√≥n de mapeo `aes()` que hemos especificado long y lat, pero es necesario agrupar por las variables `trp` y `group.regroup` para identificar las rutas √∫nicas.

```{r}
ggplot(wrld.f, aes(x = long, y = lat)) +
  geom_polygon(aes(group=group),size = 0.1,colour="black",fill="wheat",data=wrld.f,alpha=1)+
  geom_path(aes(group = paste(bdata$trp, bdata$group.regroup, sep = ".")), 
            color="darkblue", size = 0.2, data= bdata, alpha = 0.5, lineend = "round")
```


Con las siguientes capas lo que se busca es **literalmente adornar** el mapa, poniendo de fondo el color azul mar (lightblue). Por otro lado, la funci√≥n `annotation_raster()` traza sobre el mapa los adornos de las im√°genes cargadas anteriormente. Esto requiere que se especifique el cuadro delimitador de cada imagen. En este caso usamos la latitud y la longitud (en WGS84) y podemos usar estos par√°metros para cambiar la posici√≥n de la imagen y tambi√©n su tama√±o. La √∫ltima funci√≥n `coord_equal()` fijan la relaci√≥n de aspecto de la gr√°fica entre las coordenadas de longitud y latitud para que el mapa se vea correctamente.


```{r}
ggplot(wrld.f, aes(x = long, y = lat)) +
  geom_polygon(aes(group=group),size = 0.1,colour="black",fill="wheat",data=wrld.f,alpha=1)+
  geom_path(aes(group = paste(bdata$trp, bdata$group.regroup, sep = ".")), 
            color="darkblue", size = 0.2, data= bdata, alpha = 0.5, lineend = "round") +
  theme(panel.background = element_rect(fill='lightblue',colour='black')) + 
  annotation_raster(btitle, xmin = 30, xmax = 140, ymin = 51, ymax = 87) + 
  annotation_raster(compass, xmin = 65, xmax = 105, ymin = 25, ymax = 65) + 
  coord_equal()
```

Se puede quitar los ejes $x$ y $y$ de la gr√°fca para obtener un resultado como el que se muestra a continuaci√≥n:

```{r}
xquiet <- scale_x_continuous("", breaks=NULL)
yquiet <- scale_y_continuous("", breaks=NULL)
quiet <- list(xquiet, yquiet)
base <- ggplot(wrld.f, aes(x = long, y = lat))
wrld <- c(geom_polygon(aes(group=group), size = 0.1, colour= "black", fill="wheat", data=wrld.f, alpha=1))
route <- c(geom_path(aes(long,lat,group = paste(bdata$trp, bdata$group.regroup, sep = ".")), colour="#0F3B5F", size = 0.2, data= bdata, alpha = 0.5, lineend = "round"))
base + route + wrld + theme(panel.background = element_rect(fill='#BAC4B9',colour='black')) +
  annotation_raster(btitle, xmin = 30, xmax = 140, ymin = 51, ymax = 87) +
  annotation_raster(compass, xmin = 65, xmax = 105, ymin = 25, ymax = 65) +
  coord_equal() +
  quiet
```

<p class="espacio">
</p>

<p class="espacio">
</p>

<p class="espacio">
</p>




> Las notas de este taller introductorio est√°n basadas en el material de Teresa Ortiz Mancera, el libro ‚ÄúR for Data Science‚Äù escrito por Hadley Wickham y el libro "Data Visualization for Social Science" de Kieran Healy.




# Referencias

[1] Newman, G. E., & Scholl, B. J. (2012). Bar graphs depicting averages are perceptually misinterpreted: The within-the-bar bias. Psychonomic bulletin & review, 19(4), 601-607.

[2] Tufte, E. R. (2006). Beautiful Evidence. New York.

[3] Healy, K., & Moody, J. (2014). Data visualization in sociology. Annual review of sociology, 40, 105-128.

[4] Ortiz Mancera, M. T. (2017). R para an√°lisis de datos. Recuperado en l√≠nea: https://tereom.github.io/tutoriales/R_intro_visualizacion.html

[5] Keane, J. (2016). Introduction to Data Visualization. Recuperado en l√≠nea: https://github.com/jonkeane/data-visualization-intro/blob/master/slides/dataviz.rst

[6] Tufte, E. R. (2001). The visual display of quantitative information.

[7] Jackman, R. W. (1980). The impact of outliers on income inequality. American Sociological Review, 45(2), 344-347.

[8] Hewitt, C. (1977). The effect of political democracy and social democracy on equality in industrial societies: A cross-national comparison. American sociological review, 450-464.

[9] Vanhove, Jan. 2016. ‚ÄúWhat Data Patterns Can Lie Behind a Correlation Coefficient?‚Äù

[10] Qiu, L. (2015, Octubre 1). Chart shown at Planned Parenthood hearing is misleading and 'ethically wrong'. PolitiFact. Recuperado en l√≠nea: http://www.politifact.com/truth-o-meter/statements/2015/oct/01/jason-chaffetz/chart-shown-planned-parenthood-hearing-misleading-/

[11] Yanofsky, D. (2013, Septiembre 10) The chart Tim Cook doesn‚Äôt want you to see. Quartz. Recuperado en l√≠nea: https://qz.com/122921/the-chart-tim-cook-doesnt-want-you-to-see/

[12] Engel, P. (2014, February 18). This Chart Shows An Alarming Rise In Florida Gun Deaths After 'Stand Your Ground' Was... Recuperado en l√≠nea: http://www.businessinsider.com/gun-deaths-in-florida-increased-with-stand-your-ground-2014-2 

[13] Dykes, M. (2016, Octubre 23). Why Have There Been More Mass Shootings Under Obama than the Four Previous Presidents Combined? Recuperado en l√≠nea: http://truthstreammedia.com/2015/12/02/why-have-there-been-more-mass-shootings-under-obama-than-the-four-previous-presidents-combined/ 

[14] Fung, K. (2015). Junk Charts Trifecta Checkup: The Definitive Guide. Recuperado en l√≠nea: http://junkcharts.typepad.com/junk_charts/junk-charts-trifecta-checkup-the-definitive-guide.html 

[15] Willam S. Cleveland. (1994). Visualizing Data, Hobart Press.

[16] Hyndman y Fan. (1996). Sample quantiles in statistical packages, The American
Statistician.

[17] B.D. Ripley. (2004). Robust Statistics.

[18] David W. Scott. (1992) Multivariate Density Estimation, Wiley & Sons.

[19] John W. Tukey y Frederick Mosteller (1977). Data Analysis and Regression,
Addison-Wesley.

[20] Izenman y Sommer. (1998). Philatelic mixtures and multimodal densities, Journal of the
American Statistical Association.

[21] Wickham, H., & Grolemund, G. (2016). R for data science.

[22] Brunsdon, C., & Singleton, A. (2015). Geocomputation: A Practical Primer. SAGE.

[23] Cleveland, William S., and Robert McGill. (1984). ‚ÄúGraphical Perception: Theory, Experimentation, and Application to the Development of Graphical Methods.‚Äù Journal of the American Statistical Association 79: 531‚Äì34.

[24] Cleveland, William S., and Robert McGill. (1987). ‚ÄúGraphical Perception: The Visual Decoding of Quantitative Information on Graphical Displays of Data.‚Äù Journal of the Royal Statistical Society Series A 150: 192‚Äì229.

[25] Heer, Jeffrey, and Michael Bostock. (2010). ‚ÄúCrowdsourcing Graphical Perception: Using Mechanical Turk to Assess Visualization Design.‚Äù In Proceedings of the Sigchi Conference on Human Factors in Computing Systems, CHI ‚Äô10, New York, NY, USA: ACM, 203‚Äì12. http://doi.acm.org/10.1145/1753326.1753357.

[26] Tufte, E. R. (1990). Envisioning information. Graphics press.
